/* heartbeat-custom-data 0.0.1.1447459328837 */function AuthenticationProxy(a){function b(a){j.mvpdid=a.mvpdid}function c(a){j.isAuthenticated="success"===a.parameters[0]}function d(a){if(e(a)){switch(a.data.type){case"hostpageauth":c(a.data);break;case"mvpdSelected":b(a.data)}h.dispatchEvent("pageToPlayerEvent",a.data)}}function e(a){return g(a.origin)&&f(a.data.type)}function f(a){switch(a){case"hostpageauth":case"mvpdSelected":return!0;default:return!1}}function g(a){var b=["nbc.com","nbcuni.com"];for(i=0;i<b.length;i++){var c=a.length-b[i].length,d=a.indexOf(b[i]),e=a.charAt(d-1);if(d===c&&("."===e||"/"===e))return!0}return!1}var h=a,j={};this.init=function(){"undefined"!=typeof window.addEventListener?window.addEventListener("message",d,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onmessage",d)}}function ContentMetadata(){function a(a){if(c&&c.customValues){for(var b=c.customValues.length;b--;)if(c.customValues[b].fieldName===a)return c.customValues[b].value}else if(c&&c.contentCustomData){if(c.contentCustomData[a])return c.contentCustomData[a]}else if(c&&c["nbcu$"+a])return c["nbcu$"+a];return null}function b(a){if(!isNaN(a))return Boolean(Number(a));switch(String(a).toLowerCase()){case"true":case"yes":return!0;default:return!1}}var c=null,d=null,e=AvailabilityState.UNKNOWN,f=!1,g=null;this.getAvailabilityState=function(){return e},this.hasException=function(){return Boolean(a("isException"))},this.getAirDate=function(){var b;return c.airdate?b=c.airdate:Number(a("airDate"))>0&&(b=Number(a("airDate"))),b?new Date(b):b},this.getClipType=function(){return a("programmingType")||""},this.getAirDate=function(){return g},this.getClipId=function(){return a("clipId")||""},this.getGuid=function(){return c.guid},this.getTitle=function(){return c.title},this.isFullEpisode=function(){return b(a("fullEpisode"))},this.isLive=function(){return f},this.getDayPart=function(){return a("dayPart")||""},this.getEntitlement=function(){return a("entitlement")||""},this.getProvider=function(){return c.provider},this.getClipLength=function(){return c.trueLength},this.getEpisodeNumber=function(){return a("episodeNumber")},this.getExternalAdvertiserId=function(){return a("externalAdvertiserId")},this.getAdvertisingGenre=function(){return a("advertisingGenre")},this.getSeasonNumber=function(){return a("seasonNumber")},this.getPubDate=function(){return a("pubDate")},this.getAirOrder=function(){return a("airOrder")},this.getShowName=function(){for(var a=c.categories,b=0;b<a.length;b++)if(a[b]){if("live"===a[b].name.toLowerCase())return a[b].name;if(0===a[b].name.toLowerCase().indexOf("series/")){var d=0===a[b].name.toLowerCase().indexOf("series/")?7:0;return a[b].name.slice(d)}}return""},this.isLiveStream=function(){var a=c.categories[0]?"live"===c.categories[0].name.toLowerCase()?!0:!1:"";return a},this.getPermalink=function(){return a("permalink")},this.getPrimaryCategory=function(){return a("primaryCategory[0]")},this.getSecondaryCategory=function(){return a("secondaryCategory[0]")},this.getChapters=function(){return d},this.getPageLocation=function(){return ref=window.location.href.toString(),pageURL=ref.split("?")[0],pageURL},this.getPageReferrer=function(){return ref=window.document.referrer.toString(),pageURL=ref.split("?")[0],pageURL},this.setReleaseData=function(a){c=a},this.setClipData=function(a){},this.setChapters=function(a){d=a},this.setAvailabilityState=function(a){e=a},this.setAirDate=function(a){g=a},this.setIsLiveState=function(a){f=!1;for(var b,c=0;c<a.categories.length;c++)b=a.categories[c],0===b.name.toLowerCase().indexOf("live")&&(f=!0)}}function ReleaseVO(a,b,c,d){this.key=a,this.release=b,this.chapters=c,this.airdate=d}function EventTranslator(){function a(a){for(var b=0;b<a.length;b++)if(!a[b].isAd)return a[b]}function b(a){for(var b=0;b<a.length;b++)if(!a[b].baseClip.isAd)return a[b]}function c(c){var d=a(c.data.baseClips);return d.title||(d.title=b(c.data.clips).title),d}function d(a){return a.data.baseClips?c(a):a.data}function e(a){return a.data.chapters.chapters?a.data.chapters.chapters:a.data.chapters}function f(a){return a.data&&a.data.baseClip&&a.data.baseClip.contentCustomData}function g(a){var b=a.data.baseClip.contentCustomData.isException;return"object"==typeof b&&(b=b.value),"true"===b}function h(a){return f(a)&&!g(a)}function i(a){return f(a)&&g(a)&&a.data.baseClip.contentCustomData.exception===AvailabilityState.NOT_YET_AVAILABLE}function j(a){return f(a)&&g(a)&&a.data.baseClip.contentCustomData.exception===AvailabilityState.EXPIRED}this.translate=function(a){var b=d(a),c=b.guid,f=e(a),g=a.data.airdate;return new ReleaseVO(c,b,f,g)},this.translateAvailabilityState=function(a){return h(a)?AvailabilityState.AVAILABLE:i(a)?AvailabilityState.NOT_YET_AVAILABLE:j(a)?AvailabilityState.EXPIRED:AvailabilityState.UNKNOWN}}function ContentMetadataLocator(a,b){function c(a,b,c){var d=new ContentMetadata;return d.setReleaseData(a),d.setChapters(b),d.setIsLiveState(a),d.setAirDate(c),d}function d(a){f&&(f.setAvailabilityState(b.translateAvailabilityState(a)),h.controller.dispatchEvent(ContentMetadataUpdateEvent.CONTENT_METADATA_UPDATE,f))}function e(a){h.controller.addEventListener("OnReleaseStart",this.updateReleaseData)}var f,g=this,h=a,i=b,j={};this.init=function(){h.controller.addEventListener("OnMediaLoadStart",d),h.controller.addEventListener("OnReleaseStart",this.updateReleaseData),h.controller.addEventListener("OnSetReleaseUrl",e)},this.getCurrentContentMetadata=function(){return f},this.getContentMetadata=function(a){var b=i.translate(a);return j[b.key]||(j[b.key]=c(b.release,b.chapters,a.data.airdate)),j[b.key]},this.updateReleaseData=function(a){h.controller.removeEventListener("OnReleaseStart",this.updateReleaseData),f=g.getContentMetadata(a),h.controller.dispatchEvent(ContentMetadataUpdateEvent.CONTENT_METADATA_UPDATE,f)}}function loadHeartbeatApp(){console.log("[NBCHeartbeatApp] -----> OnPlayerLoaded"),NBCHeartbeatCustomData.init()}function NBCHeartbeatApp(){this.contentMetadata=null,this.cache=null,app=this}function NBCHeartbeatCallback(a){return NBCHeartbeatCustomData.pluginCallback(a)}var AvailabilityState={AVAILABLE:"Available",NOT_YET_AVAILABLE:"NotYetAvailable",EXPIRED:"Expired",UNKNOWN:"Unknown"};NBCHeartbeatApp.prototype.init=function(){app.initServices(),app.initContentMetadata()},NBCHeartbeatApp.prototype.initServices=function(){console.log("[NBCHeartbeatApp] -----> initServices() contentMetadata created");var a=new EventTranslator;contentMetadata=new ContentMetadataLocator($pdk,a),contentMetadata.init(),authenticationProxy=new AuthenticationProxy($pdk.controller),authenticationProxy.init()},NBCHeartbeatApp.prototype.initContentMetadata=function(){app.cache?(console.log("[NBCHeartbeatApp] -----> cache detected, use stored release data."),contentMetadata.updateReleaseData(app.cache)):(console.log("[Metrics] 2 [MAIN] -----> cache NOT detected, wait for PDK events."),$pdk.controller.addEventListener("OnMediaLoadStart",contentMetadata.contentMetadataupdateAvailabilityState),$pdk.controller.addEventListener("OnReleaseStart",contentMetadata.updateReleaseData),$pdk.controller.addEventListener("OnSetReleaseUrl",contentMetadata.onSetReleaseUrl))},NBCHeartbeatApp.prototype.pluginCallback=function(a){if("OnReleaseStart"==a.type){a.data;return{myField:"My Custom main value!!!!!!"}}if("OnMediaStart"==a.type&&a.data.baseClip.isAd){a.data;return{myField:"My Custom ad value!!!!!!"}}if("OnMediaStart"==a.type&&!a.data.baseClip.isAd){a.data;return{myField:"My Custom chapter value!!!!!!"}}};var NBCHeartbeatCustomData=new NBCHeartbeatApp;$pdk.controller.addEventListener("OnPlayerLoaded",loadHeartbeatApp),$pdk.controller.addEventListener("OnReleaseStart",function(a){console.log("[NBCHeartbeatApp] -----> OnReleaseStart"),NBCHeartbeatCustomData.cache=a});